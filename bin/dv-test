#!/bin/bash
source $(dv-path lib/common.sh) # -*-mode: sh-mode -*-

# Make sure the directory is clean now, so we can clean up
# anything which tests leave behind in the main project directory
dv-git-assert-clean

if [ ! -f test-all.sh ]; then
    dv-install cltest
fi

out=_to_developer/test-all.out
rm -rf "$out"
mkdir -p "$out"
    
if ! timeout 60 bash test-all.sh > $out/log.txt 2>&1; then
    echo "### [dv-test] test-all.sh FAILED exit status $?" >> $out/log.txt
    status=1
else 
    echo "test-all.sh exit status 0 -- ALL TESTS PASSED!" >> $out/log.txt
    status=0
fi

# Clean up anything which got added
git clean -qfd

exit $status
